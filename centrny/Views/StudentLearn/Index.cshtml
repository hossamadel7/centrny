@using Microsoft.Extensions.Localization
@inject IStringLocalizerFactory LocalizerFactory
@{
    var Localizer = LocalizerFactory.Create("StudentLearn", System.Reflection.Assembly.GetExecutingAssembly().GetName().Name);
    ViewData["Title"] = Localizer["Students"];
}
<link href="~/css/Hamody.css" rel="stylesheet" />
<style>
    .subject-text {
        font-weight: bold;
        color: #222;
    }

    .d-flex.gap-2 > * {
        margin-right: 10px;
    }

    #editLearnModalBody table th, #editLearnModalBody table td {
        vertical-align: middle;
    }

    .autocomplete-dropdown {
        border: 1px solid #ccc;
        background: #fff;
        position: absolute;
        z-index: 10000;
    }

    .autocomplete-item {
        padding: 4px 10px;
        cursor: pointer;
    }

        .autocomplete-item:hover {
            background: #eee;
        }

    .learn-responsive-wrapper {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

        .learn-responsive-wrapper table {
            min-width: 1100px;
        }

    #studentStatsModal .card-header {
        background: #f7f7f7;
        font-size: 1.1em;
    }
    /* Subscribed badge styling */
    .badge.bg-success {
        background: #00b894 !important;
        color: #fff !important;
        font-weight: 600;
        margin-left: 4px;
    }
</style>

<!-- JS Localization keys -->
<div id="js-localization"
     data-title="@Localizer["Students"]"
     data-all-years="@Localizer["AllYears"]"
     data-all-subjects="@Localizer["AllSubjects"]"
     data-search-placeholder="@Localizer["SearchPlaceholder"]"
     data-no-records="@Localizer["NoRecordsFound"]"
     data-add-subject="@Localizer["AddSubject"]"
     data-change-time="@Localizer["ChangeTime"]"
     data-choose-subject="@Localizer["ChooseSubject"]"
     data-choose-teacher="@Localizer["ChooseTeacher"]"
     data-choose-branch="@Localizer["ChooseBranch"]"
     data-choose-schedule="@Localizer["ChooseSchedule"]"
     data-no-subjects="@Localizer["NoSubjects"]"
     data-yes="@Localizer["Yes"]"
     data-no="@Localizer["No"]"
     data-search="@Localizer["Search"]"
     data-online="@Localizer["Online"]"
     data-active="@Localizer["Active"]"
     data-inactive="@Localizer["Inactive"]"
     data-no-subjects-assigned="@Localizer["NoSubjectsAssigned"]"
     data-failed-to-add="@Localizer["FailedToAdd"]"
     data-failed-to-update="@Localizer["FailedToUpdate"]"
     data-failed-to-delete="@Localizer["FailedToDelete"]"
     data-cancel="@Localizer["Cancel"]"
     data-edit="@Localizer["Edit"]"
     data-save="@Localizer["Save"]"
     data-loading="@Localizer["Loading"]"
     data-student="@Localizer["Student"]"
     data-year="@Localizer["Year"]"
     data-teacher="@Localizer["Teacher"]"
     data-subject="@Localizer["Subject"]"
     data-branch="@Localizer["Branch"]"
     data-schedule="@Localizer["Schedule"]"
     data-actions="@Localizer["Actions"]"
     data-current-schedule="@Localizer["CurrentSchedule"]"
     data-new-schedule="@Localizer["NewSchedule"]"
     data-subscribed="@Localizer["Subscribed"]" />

<div class="daily-container" style="max-width:1550px;">
    <div class="questions-header">
        <h2><i class="fas fa-user-graduate"></i>@Localizer["Students"]</h2>
    </div>

    <div class="row mb-3 w-100 justify-content-center">
        <div class="col-md-2 mb-2">
            <select id="yearFilter" class="form-control modern-input styled-select"></select>
        </div>
        <div class="col-md-2 mb-2">
            <select id="subjectFilter" class="form-control modern-input styled-select"></select>
        </div>
        <div class="col-md-3 mb-2">
            <input type="text" id="searchInput" class="form-control modern-input" autocomplete="off" />
        </div>
        <div class="col-md-2 mb-2">
            <button id="searchBtn" class="modern-btn w-100" style="background: var(--primary-gradient);"></button>
        </div>
    </div>

    <div id="learnTableContainer" class="w-100"></div>
    <nav>
        <ul class="pagination" id="learnPagination"></ul>
    </nav>
</div>

<!-- Add Subject Modal -->
<div class="modal fade" id="addSubjectModal" tabindex="-1" role="dialog" aria-labelledby="addSubjectModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form id="addLearnForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSubjectModalLabel">@Localizer["AddSubjectToStudent"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="@Localizer["Cancel"]">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="StudentCode" />
                    <input type="hidden" name="YearCode" />
                    <input type="hidden" name="EduYearCode" />
                    <input type="hidden" name="RootCode" />
                    <input type="hidden" name="IsActive" value="1" />
                    <div class="form-group">
                        <label>@Localizer["Subject"]</label>
                        <select name="SubjectCode" class="form-control modern-input styled-select" required></select>
                    </div>
                    <div class="form-group">
                        <label>@Localizer["Teacher"]</label>
                        <select name="TeacherCode" class="form-control modern-input styled-select" required></select>
                    </div>
                    <div class="form-group">
                        <label>@Localizer["Branch"]</label>
                        <select name="BranchCode" class="form-control modern-input styled-select" required></select>
                    </div>
                    <div class="form-group">
                        <label>@Localizer["Schedule"]</label>
                        <select name="ScheduleCode" class="form-control modern-input styled-select" required></select>
                    </div>
                    <div class="form-group form-check">
                        <input type="checkbox" name="IsOnline" class="form-check-input" id="isOnlineCheck">
                        <label class="form-check-label" for="isOnlineCheck">@Localizer["Online"]</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="modern-btn" style="background: var(--primary-gradient);">@Localizer["AddSubject"]</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">@Localizer["Cancel"]</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Learn Modal -->
<div class="modal fade" id="editLearnModal" tabindex="-1" role="dialog" aria-labelledby="editLearnModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editLearnModalLabel">@Localizer["EditSchedulesForStudent"]</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="@Localizer["Cancel"]">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="editLearnModalBody"></div>
            <div class="modal-footer" id="editLearnModalFooter" style="display:none;">
                <button type="submit" form="editAllSchedulesForm" class="modern-btn edit-btn">@Localizer["Save"]</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">@Localizer["Cancel"]</button>
            </div>
        </div>
    </div>
</div>

<!-- Student Statistics Modal -->
<div class="modal fade" id="studentStatsModal" tabindex="-1" role="dialog" aria-labelledby="studentStatsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="studentStatsModalLabel">@Localizer["Student"] @Localizer["Statistics"]</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="@Localizer["Cancel"]">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Only the intended filter row below! -->
                <div class="row mb-3 d-flex" style="gap:15px;">
                    <div>
                        <label><b>Type:</b></label>
                        <select id="studentStatsTypeFilter" class="form-control" style="max-width:200px;display:inline-block;margin-left:10px;">
                            <option value="">All</option>
                            <option value="true">Exams Only</option>
                            <option value="false">Assignments Only</option>
                        </select>
                    </div>
                    <div>
                        <label><b>Filter by Subject:</b></label>
                        <select id="studentStatsSubjectFilter" class="form-control" style="max-width:300px;display:inline-block;margin-left:10px;">
                            <!-- options via JS -->
                        </select>
                    </div>
                </div>
                <div id="studentStatsModalBody"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">@Localizer["Cancel"]</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/Student.js"></script>
}